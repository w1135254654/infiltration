
## 主动信息收集的原理

### 主动信息收集的特点


> - 直接与目标系统交互通信
> 
> - 无法避免留下访问的痕迹
> 
> - 使用受控的第三方电脑进行探测，使用代理或已经被控制的机器，做好被封杀的准备
> 
> - 扫描发送不同的探测，根据返回结果判断目标状态


### 发现目标主机的过程


> 1. 识别存活主机，发现潜在的被攻击目标
> 
> 2. 输出一个 IP 地址列表比如 IP 地址段 IP 地址范围
> 
> 3. 使用二、三、四层进行探测发现


### `OSI` 七层模型和 `TCP/IP` 五层模型

<img src="assets/image/渗透测试系统Kali_Linux/主动信息收集/模型图层.png" alt="模型图层" align=center />

这里我们只对 `OSI` 各层进行功能上的大概阐述，不详细深究，因为每一层实际都是一个复杂的层。后面我也会根据个人方向展开部分层的深入学习。这里我们就大概了解一下。我们从最顶层——应用层开始介绍。整个过程以公司 A 和公司 B 的一次商业报价单发送为例子进行讲解

**第 7 层应用层：** <br/>
`OSI` 中的最高层。为特定类型的网络应用提供了访问 `OSI` 环境的手段。应用层确定进程之间通信的性质，以满足用户的需要。应用层不仅要提供应用进程所需要的信息交换和远程操作，而且还要作为应用进 程的用户代理，来完成一些为进行信息交换所必需的功能。它包括：文件传送访问和管理 `FTAM`、虚拟终 端 VT、事务处理 TP、远程数据库访问 RDA、制造报文规范 MMS、目录服务 DS 等协议；应用层能与应 用程序界面沟通，以达到展示给用户的目的。 在此常见的协议有:`HTTP，HTTPS，FTP，TELNET，SSH， SMTP，POP3` 等

**第 6 层表示层：** <br/>
主要用于处理两个通信系统中交换信息的表示方式。为上层用户解决用户信息的语法问题。它包括数据格式交换、数据加密与解密、数据压缩与终端类型的转换

**第 5 层会话层：** <br/>
在两个节点之间建立端连接。为端系统的应用程序之间提供了对话控制机制。此服务包括建立连接是以全双工还是以半双工的方式进行设置，尽管可以在层 4 中处理双工方式 ；会话层管理登入和注销过程。 它具体管理两个用户和进程之间的对话。如果在某一时刻只允许一个用户执行一项特定的操作，会话层协议就会管理这些操作，如阻止两个用户同时更新数据库中的同一组数据

**第 4 层传输层：** <br/>
传输层建立了主机端口到端口的链接，传输层的作用是为上层协议（上层会会话层）提供端口到端口 的可靠和透明的数据传输服务，包括处理差错控制和流量控制等问题。该层向高层屏蔽了下层数据通信 的细节，使高层用户看到的只是在两个传输实体间的一条主机到主机的、可由用户控制和设定的、可靠 的数据通路。我们通常说的，`TCP UDP` 就是在这一层

**第 3 层网络层：** <br/>
本层通过 `IP` 寻址来建立两个节点之间的连接，为源端的运输层送来的分组，选择合适的路由和交换节 点，正确无误地按照地址传送给目的端的运输层。就是通常说的 IP 层。这一层就是我们经常说的 IP 协议 层。IP 协议是 `Internet` 的基础

**第 2 层数据链路层：** <br/>
将比特组合成字节,再将字节组合成帧,使用链路层地址 (以太网使用 `MAC` 地址)来访问介质,并进行差错检测

**第 1 层物理层：** <br/>
处于 `OSI` 参考模型的最底层。物理层的主要功能是利用物理传输介质为数据链路层提供物理连接，以便透明的传送比特流。常用设备有（各种物理设备）网卡、集线器、中继器、调制解调器、网线、双绞线、 同轴电缆


**`TCP/IP` 五层协议和 `OSI` 的七层协议对应关系**

<img src="assets/image/渗透测试系统Kali_Linux/主动信息收集/协议对应关系.png" alt="协议对应关系" align=center />

**对应的网络设备关系**

<img src="assets/image/渗透测试系统Kali_Linux/主动信息收集/对应的网络设备关系.png" alt="对应的网络设备关系" align=center />

**对应的协议关系**

<img src="assets/image/渗透测试系统Kali_Linux/主动信息收集/对应的协议关系.png" alt="对应的协议关系" align=center />


### 基于 `OSI` 模型进行扫描的优缺点



> 1. 二层扫描的优缺点 
> 
> - 优点：扫描速度快、可靠 
> - 缺点：不可路由

> 2. 三层扫描的优缺点 
> 
> - 优点：可路由，速度较快 
> - 缺点：
>    - 速度比二层慢，经常被边界防火墙过滤 
>    - 使用 `IP、icmp` 协议

> 3. 四层扫描的优缺点 
> - 优点：
>    - 可路由且结果可靠 
>    - 不太可能被防火墙过滤 
>    - 可以发现所有端口都被过滤的主机 
> - 缺点：
>    - 基于状态过滤的防火墙可能过滤扫描 
>    - 全端口扫描速度慢