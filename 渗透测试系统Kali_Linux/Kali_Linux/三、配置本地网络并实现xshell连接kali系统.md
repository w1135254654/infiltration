
## 本地网络配置

### 配置静态 IP 地址

> [!tip|style:flat]
> <span style='color: red'>注：使用桥接网络请根据宿主机 IP 地址修改。</span>

查看物理机 win10 的 IP：按下 `windows 键+R`，

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/本地网络配置/配置静态 IP 地址/按下 windows 键+R.png" alt="按下 windows 键+R" align=center />

打开运行窗口，输入：`cmd`

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/本地网络配置/配置静态 IP 地址/运行cmd.png" alt="运行cmd" align=center />

输入命令：`ipconfig`

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/本地网络配置/配置静态 IP 地址/输入命令ipconfig.png" alt="输入命令ipconfig" align=center />

测试 `ipv4` 连通性：

```linux
C:\Users\shen>ping 192.168.1.1 
正在 Ping 192.168.1.1 具有 32 字节的数据: 
来自 192.168.1.1 的回复: 字节=32 时间=1ms TTL=64 
来自 192.168.1.1 的回复: 字节=32 时间=1ms TTL=64
```

> [!note|style:flat]
> ipv4 和 ipv6 区别：地址长度 IPv4 协议具有 32 位(4 字节)地址长度;IPv6 协议具有 128 位(16 字节) 地址长度。

测试 `ipv6` 连通性：

```linux
C:\Users\shen>ping fe80::1%3 
正在 Ping fe80::1%3 具有 32 字节的数据: 
来自 fe80::1%3 的回复: 时间=16ms 
来自 fe80::1%3 的回复: 时间=13ms 
来自 fe80::1%3 的回复: 时间=20ms 
来自 fe80::1%3 的回复: 时间=17ms
```

```linux
C:\Users\shen>ping fe80::704c:36aa:1919:b127%3 
正在 Ping fe80::704c:36aa:1919:b127%3 具有 32 字节的数据: 
来自 fe80::704c:36aa:1919:b127%3 的回复: 时间<1ms 
来自 fe80::704c:36aa:1919:b127%3 的回复: 时间<1ms
```

> [!tip|style:flat]
> 注：IPv6 地址中的%百分号是网卡 interface 标识。这个表示该地址仅限于标号为 21 的网络接口（一般指网卡或者虚拟网卡）。

打开`kali`
```kali
┌──(root�xuegod53)-[~] 
└─# vim /etc/network/interfaces
```

添加以下内容：

```kali
auto eth0 
iface eth0 inet static 		#配置 eth0 使用静态地址
address 192.168.1.53 		#配置 eth0 的固定 IP 地址，网段要和物理机所在网段一样，且 此 IP 没有被其他人使用。
netmask 255.255.255.0 		#配置子网掩码
gateway 192.168.1.1			#配置网关
```

配置完后的效果如下：

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/本地网络配置/配置静态 IP 地址/配置静态 IP.png" alt="配置静态 IP" align=center />


### 重启网络服务

关闭 `NetworkManager`

```kali
┌──(root�xuegod53)-[~] 
└─# systemctl stop NetworkManager
```

> [!tip|style:flat]
> 注：关闭 `NetworkManager` 服务，该服务是网络服务的图形管理工具，该服务会自动接管 `networking` 服务，有可能造成重启 `networking` 服务时配置不生效的问题。

再次重启网络服务
```kali
┌──(root�xuegod53)-[~] 
└─# systemctl restart networking
```

查看 `IP`：
```kali
┌──(root�xuegod53)-[~] 
└─# ifconfig
```

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/本地网络配置/重启网络服务/查看配置好的 IP.png" alt="查看配置好的 IP" align=center />

添加 `dns` 服务器配置
```kali
┌──(root�xuegod53)-[~] 
└─# vim /etc/resolv.conf 		#在文档最后插入 DNS 地址

┌──(root�xuegod53)-[~]
└─# Generated by NetworkManager

┌──(root�xuegod53)-[~]
└─# nameserver 114.114.114.114		#或者nameserver 8.8.8.8

┌──(root�xuegod53)-[~]
└─# systemctl restart networking 		#重启网络服务
```

#### 临时配置 IP 地址(了解)
```kali
┌──(root�xuegod53)-[~] 
└─# ifconfig eth0:1 192.168.1.54/24 	#给一个网卡配置临时配置 IP。24代表子网掩码
```

> [!tip|style:flat]
> 注：临时 IP **重启网络服务**或 `reboot` **重启系统**就没有了。


#### 受限制的网络环境(了解)

> [!note|style:flat]
> 校园网、办公网络、拨号网络可能存在网络验证，如果是以上网络环境的同学，必须使用虚拟机的 `NAT` 模式网络。

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/本地网络配置/重启网络服务/受限制的网络环境/虚拟机设置.png" alt="虚拟机设置" align=center />

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/本地网络配置/重启网络服务/受限制的网络环境/配置NAT网络模式.png" alt="配置NAT网络模式" align=center />


#### DHCP 模式自动获取 IP(了解)

```kali
┌──(root�xuegod53)-[~] 
└─# vim /etc/network/interfaces
```

```kali
auto lo 
iface lo inet loopback 
auto eth0 
iface eth0 inet dhcp
```

###### 重启网络服务

```kali
┌──(root�xuegod53)-[~] 
└─# systemctl stop networking
```

```kali
┌──(root�xuegod53)-[~] 
└─# systemctl start networking
```

> [!tip|style:flat]
> 注：如果使用 `ystemctl restart networking` 重启网络服务，有时需要执行两次才能生效。所以最 好先 `stop` 再 `start networking`

```kali
┌──(root�xuegod53)-[~] 
└─# ifconfig eth0
```


#### 实战：基于 NAT 模式配置静态 IP 地址

配置静态地址需要根据 `NAT` 模式的网络配置作为参考。

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/本地网络配置/重启网络服务/实战：基于 NAT 模式配置静态 IP 地址/虚拟机编辑虚拟网络编辑器.png" alt="虚拟机编辑虚拟网络编辑器" align=center />

`NAT` 设置中可以查看网关地址

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/本地网络配置/重启网络服务/实战：基于 NAT 模式配置静态 IP 地址/配置NAT网络模式.png" alt="配置NAT网络模式" align=center />

----------

> [!tip|style:flat]
> 注：如果把虚拟机网络相关参数，改乱了。可以点：**还原默认设置**

##### 配置静态 IP

```kali
┌──(root�xuegod53)-[~] 
└─# vim /etc/network/interfaces
```

```kali
auto lo 
iface lo inet loopback 
auto eth0 
iface eth0 inet static 
address 192.168.111.53 
netmask 255.255.255.0 
gateway 192.168.111.2
```

建议使用这种方式重启网络服务，先关闭，再启用

```kali
┌──(root�xuegod53)-[~] 
└─# systemctl stop networking
```

```kali
┌──(root�xuegod53)-[~] 
└─# systemctl start networking
```



## 配置 sshd 服务并使用 xshell 连接

### 允许 `root` 用户登录 `sshd` 服务

```kali
┌──(root�xuegod53)-[~] 
└─# vim /etc/ssh/sshd_config
```

修改以下内容第 **`34`** 行和第 **`39`** 行

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/配置 sshd 服务并使用 xshell 连接/允许 root 用户登录 sshd 服务/修改kali中sshd服务配置文件.png" alt="修改kali中sshd服务配置文件" align=center />


> **把 34 行的 `prohibit-password` 改为 `yes` 并把 34 行 和 39 行前的`#`号删掉**，改完效果如 下图：

> [!attention|style:flat]
> 注：<br/>
> `prohibit-password`：禁止密码 <br/>
> `PubkeyAuthentication`：公钥身份验证，开启此项允许 Xshell 配置 SSH 秘钥登录

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/配置 sshd 服务并使用 xshell 连接/允许 root 用户登录 sshd 服务/配置 sshd 服务并使用 xshell 连接.png" alt="配置 sshd 服务并使用 xshell 连接" align=center />

重启 `ssh` 服务

```kali
┌──(root�xuegod53)-[~] 
└─# /etc/init.d/ssh restart

#Restarting ssh (via systemctl): ssh.service.
```

配置 `sshd` 服务开机自动启动

```kali
┌──(root�xuegod53)-[~] 
└─# update-rc.d ssh enable
```

### 使用 xshell 连接 kali

安装 xshell，双击：xshell-7-家庭免费版.exe 进行安装

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/配置 sshd 服务并使用 xshell 连接/使用 xshell 连接 kali/安装 xshell.png" alt="安装 xshell" align=center />

查看 `kali IP` 地址是多少

```kali
┌──(root�xuegod53)-[~] 
└─# ifconfig
```

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/配置 sshd 服务并使用 xshell 连接/使用 xshell 连接 kali/查看 kali IP 地址.png" alt="查看 kali IP 地址" align=center />

回到 windows 上配置 `xshell`

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/配置 sshd 服务并使用 xshell 连接/使用 xshell 连接 kali/配置 xshell.png" alt="配置 xshell" align=center />

输入名称和 ip 地址

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/配置 sshd 服务并使用 xshell 连接/使用 xshell 连接 kali/输入名称和 ip 地址.png" alt="输入名称和 ip 地址" align=center />

配置终端模式，`VT` 模式选择设置为普通，否则小键盘不好使

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/配置 sshd 服务并使用 xshell 连接/使用 xshell 连接 kali/配置终端VT模式.png" alt="配置终端VT模式" align=center />

输入用户名

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/配置 sshd 服务并使用 xshell 连接/使用 xshell 连接 kali/输入用户名.png" alt="输入用户名" align=center />

输入密码

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/配置 sshd 服务并使用 xshell 连接/使用 xshell 连接 kali/输入密码.png" alt="输入密码" align=center />

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/配置 sshd 服务并使用 xshell 连接/使用 xshell 连接 kali/保存秘钥.png" alt="保存秘钥" align=center />

点击确定即可远程连接到 `kali`

<img src="assets/image/渗透测试系统Kali_Linux/Kali_Linux/三、配置本地网络并实现xshell连接kali系统/配置 sshd 服务并使用 xshell 连接/使用 xshell 连接 kali/远程连接到 kali.png" alt="远程连接到 kali" align=center />

