
## 被动信息收集

### 被动信息收集概述和目的


> 信息收集的方式可以分为两种：**被动**和**主动**。


> - 被动信息收集方式：**是指利用第三方的服务对目标进行访问了解**，比例：`Google 搜索`。
> - 主动的信息收集方式：**通过直接访问、扫描网站，这种将流量流经网站的行为**。比如：`nmap 扫描端口`。

> [!note|style:flat]
> **被动信息收集的目的**：通过公开渠道，去获得目标主机的信息，从而不与目标系统直接交互，避免留下痕迹。


### 信息收集内容

> 1. IP 地址段
> 2. 域名信息
> 3. 邮件地址
> 4. 文档图片数据
> 5. 公司地址
> 6. 公司组织架构
> 7. 联系电话 / 传真号码
> 8. 人员姓名 / 职务
> 9. 目标系统使⽤的技术架构
> 10. 公开的商业信息

### 信息用途

> 1. 信息描述目标
> 2. 发现目标
> 3. 社会工程学攻击
> 4. 物理缺口


## 通过 DNS 收集信息

### 域名解析原理

#### DNS 服务器概述

`DNS`（Domain Name Server，域名服务器）是进行域名(domain name)和与之相对应的 `IP` 地址 (IP address)转换的服务器。DNS 服务器分为**根域 `DNS` 服务器**、**顶级域名 `DNS` 服务器**。根域 DNS 服 务器有 13 个，都存储了全部的顶级域名服务器的所在地址


> 登录：https://wanwang.aliyun.com/ 买域名绑定到你的云主机上

<img src="assets/image/渗透测试系统Kali_Linux/利用第三方服务对目标进行被动信息收集防止被发现/通过 DNS 收集信息/域名解析原理/DNS 服务器概述/万网域名注册.png" alt="万网域名注册" align=center />


#### 域名记录


> `A`，`Cname`，`NS`，`MX`，`PTR`


> **1. `A 记录（Address）`正向解析**
> 
> A 记录是将一个主机名（全称域名 FQDN）和一个 IP 地址关联起来。这也是大多数客户端程序默认 的查询类型。<br/>
> `例：xuegod.cn-> 8.8.8.6`
> 
> **2. `PTR 记录（Pointer）`反向解析** 
> 
> PTR 记录将一个 IP 地址对应到主机名（全称域名 FQDN）。这些记录保存在 in-addr.arpa 域中。
> 
> **3. `CNAME 记录(Canonical Name)`别名**
> 
> 别名记录，也称为规范名字(Canonical Name)。这种记录允许您将多个名字映射到同一台计算机。<br/>
> `例：www.xuegod.cn 对应 IP8.8.8.6`，`web.xuegod.cn 对应 IP8.8.8.6`
> 
> **4. `MX 记录（Mail eXchange）`** 
> 
> MX 记录是邮件交换记录，它指向一个邮件服务器，用于电子邮件系统发邮件时根据 收信人的地址后 缀来定位邮件服务器。
> `例：mail.xuegod.cn`<br/>
> 当有多个 MX 记录（即有多个邮件服务器）时，则需要设置数值来确定其优先级。通过设置优先级数 字来指明首选服务器，数字越小表示优先级越高。
> 
> **5. `NS 记录（Name Server）`**
> 
> NS（Name Server）记录是域名服务器记录，也称为授权服务器，用来指定该域名由哪个 DNS 服 务器来进行解析。 
> `例：dns.xuegod.cn`


#### DNS 缓存服务器


> **缓存 DNS 服务器**：不负责解析域，只是缓存域名解析结果。


#### DNS 查询过程

一个 `DNS` 查询过程，通过 8 个步骤的解析过程就使得客户端可以顺利访问 www.163.com 这个域名， 但实际应用中，通常这个过程是非常迅速的

<img src="assets/image/渗透测试系统Kali_Linux/利用第三方服务对目标进行被动信息收集防止被发现/通过 DNS 收集信息/域名解析原理/DNS 查询过程/DNS 查询过程.png" alt="万网域名注册" align=center />


DNS 查询过程文档化


> 1. **浏览器缓存**:当用户通过浏览器访问某域名时，浏览器首先会在自己的缓存中查找是否有该域名对 应的 IP 地址（若曾经访问过该域名且没有清空缓存便存在）
> 
> 2. **系统缓存**:当浏览器缓存中无域名对应 IP 则会自动检查用户计算机系统 Hosts 文件 DNS 缓存是 否有该域名对应 IP
> 
> 3. **路由器缓存**:当浏览器及系统缓存中均无域名对应 IP 则进入路由器缓存中检查，以上三步均为客户 端的 DNS 缓存
> 
> 4. **ISP（互联网服务提供商）DNS 缓存(一般就是本地 DNS 服务器)**:当在用户客户端查找不到域名 对应 IP 地址，则将进入 ISP DNS 缓存中进行查询。比如你用的是电信的网络，则会进入电信的 DNS 缓 存服务器中进行查找
> 
> 5. **根域名服务器**：当以上均未完成，则进入根服务器进行查询。全球仅有 13 台根域名服务器，1 个 主根域名服务器，其余 12 为辅根域名服务器。根域名收到请求后会查看区域文件记录，若无则将其管辖 范围内顶级域名（如.com）服务器 IP 告诉本地 DNS 服务器
> 
> 6. **顶级域名服务器**：顶级域名服务器收到请求后查看区域文件记录，若无则将其管辖范围内主域名服务器的 IP 地址告诉本地 DNS 服务器
> 
> 7. **主域名服务器**：主域名服务器接受到请求后查询自己的缓存，如果没有则进入下一级域名服务器进行查找，并重复该步骤直至找到正确纪录
> 
> 8. **保存结果至缓存**：本地域名服务器把返回的结果保存到缓存，以备下一次使用，同时将该结果反馈给客户端，客户端通过这个 IP 地址与 web 服务器建立链接


#### DNS 查询方式： 

<img src="assets/image/渗透测试系统Kali_Linux/利用第三方服务对目标进行被动信息收集防止被发现/通过 DNS 收集信息/域名解析原理/DNS 查询方式/DNS 查询方式.png" alt="DNS 查询方式" align=center />

`递归查询`：主机向本地域名服务器的查询一般都是采用递归查询。

> [!note|style:flat]
> **递归查询**：客户端只发一次请求，要求对方给出最终结果。

----------

`迭代查询`：本地域名服务器向根域名服务器的查询的迭代查询。
`迭代查询`：本地域名服务器向根域名服务器的查询的迭代查询。
`迭代查询`：本地域名服务器向根域名服务器的查询的迭代查询。
`迭代查询`：本地域名服务器向根域名服务器的查询的迭代查询。
`迭代查询`：本地域名服务器向根域名服务器的查询的迭代查询。
`迭代查询`：本地域名服务器向根域名服务器的查询的迭代查询。
`迭代查询`：本地域名服务器向根域名服务器的查询的迭代查询。
`迭代查询`：本地域名服务器向根域名服务器的查询的迭代查询。
`迭代查询`：本地域名服务器向根域名服务器的查询的迭代查询。


> [!note|style:flat]
> **迭代查询**：客户端发出一次请求，对方如果没有授权回答，它就会返回一个能解答这个查询的其它名称服 务器列表，客户端会再向返回的列表中发出请求，直到找到最终负责所查域名的名称服务器，从它得到最终结果。


### DNS 信息收集